---
import PageLayout from '../../layouts/PageLayout.astro';
import ArticleCard from '../../components/ArticleCard.astro';
import { getCollection } from 'astro:content';
import { Icon } from 'astro-icon/components';

export async function getStaticPaths() {
  const allPosts = await getCollection('posts');
  const uniqueCategories = [...new Set(allPosts.map(post => post.data.category))];

  return uniqueCategories.map(category => {
    const filteredPosts = allPosts
      .filter(post => post.data.category === category)
      .sort((a, b) => new Date(b.data.publishedAt).valueOf() - new Date(a.data.publishedAt).valueOf());
    
    return {
      params: { category },
      props: { posts: filteredPosts },
    };
  });
}

const { category } = Astro.params;
const { posts } = Astro.props;

const categoryMap: Record<string, string> = {
    'tech': '技术',
    'essay': '随笔',
    'project': '项目'
};

const displayCategory = categoryMap[category] || category;
---

<PageLayout title={`分类: ${displayCategory} - 秋兰以为佩的博客`}>
    <div class="mb-6 flex items-center justify-between">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white flex items-center gap-2">
            <Icon name="ri:folder-line" class="text-primary-500" />
            分类: <span class="text-primary-500">{displayCategory}</span>
        </h2>
    </div>
    <div class="space-y-6">
        {posts.map(post => (
            <ArticleCard article={post} />
        ))}
    </div>
</PageLayout>
