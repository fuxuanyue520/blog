---
import { Icon } from 'astro-icon/components';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');

// Calculate real category counts
const categoryCount = allPosts.reduce((acc, post) => {
  const cat = post.data.category;
  acc[cat] = (acc[cat] || 0) + 1;
  return acc;
}, {} as Record<string, number>);

// Display Name Mapping
const categoryMap: Record<string, string> = {
    'tech': '技术',
    'essay': '随笔',
    'project': '项目',
    'other': '其他'
};

const categoryIconMap: Record<string, string> = {
    'tech': 'ri:code-box-line',
    'essay': 'ri:quill-pen-line',
    'project': 'ri:stack-line',
    'other': 'ri:more-fill'
};
---

<div class="bg-dark-800 rounded-xl p-3 lg:p-5 shadow-lg border border-white/5 group hover:border-primary-500/30 transition-colors">
  <div class="flex items-center gap-1 mb-2 lg:mb-3 text-primary-400 font-bold border-l-4 border-primary-500 pl-2 text-lg lg:text-xl">
    <Icon name="ri:folder-2-line" />
    <span>分类</span>
  </div>
  
  <div class="flex flex-col gap-1 lg:gap-2">
    {Object.entries(categoryCount).map(([slug, count], index) => (
      <a href={`/category/${slug}`} class="flex items-center justify-between p-1.5 lg:p-2 rounded-lg hover:bg-dark-700 transition-colors group/item animate-slide-in-right" style={`animation-delay: ${(index + 1) * 100}ms`}>
        <span class="text-gray-300 text-sm lg:text-base group-hover/item:text-primary-400 transition-colors flex items-center gap-2">
            <Icon name={categoryIconMap[slug] || 'ri:folder-line'} class="text-primary-500" />
            {categoryMap[slug] || slug}
        </span>
        <span class="bg-dark-700 text-primary-400 text-xs lg:text-sm px-1.5 py-0.5 rounded-full group-hover/item:bg-primary-500 group-hover/item:text-white transition-colors">
          {count}
        </span>
      </a>
    ))}
  </div>
</div>
