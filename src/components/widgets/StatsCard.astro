---
import { Icon } from 'astro-icon/components';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('posts');

// 1. Calculate Post Count
const postCount = allPosts.length;

// 2. Calculate Category Count (Real)
const categories = new Set(allPosts.map(p => p.data.category));
const categoryCount = categories.size;

// 3. Calculate Word Count
const wordCount = allPosts.reduce((acc, post) => acc + post.body.length, 0);

// 4. Calculate Run Days (Real)
const startDate = new Date('2025-12-19'); // Set your blog start date here
const today = new Date();
const diffTime = Math.abs(today.getTime() - startDate.getTime());
const runDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
---

<div class="bg-dark-800 rounded-xl p-3 shadow-lg border border-white/5 group hover:border-primary-500/30 transition-colors">
  <div class="flex items-center gap-1 mb-2 text-primary-400 font-bold border-l-4 border-primary-500 pl-2">
    <Icon name="ri:bar-chart-box-line" />
    <span>站点统计</span>
  </div>
  
  <div class="space-y-2">
    <div class="flex justify-between items-center text-xs">
        <span class="text-gray-400 flex items-center gap-2"><Icon name="ri:article-line" class="text-primary-500"/> 文章</span>
        <span class="text-white font-mono">{postCount}</span>
    </div>
    <div class="flex justify-between items-center text-xs">
        <span class="text-gray-400 flex items-center gap-2"><Icon name="ri:folder-line" class="text-primary-500"/> 分类</span>
        <span class="text-white font-mono">{categoryCount}</span>
    </div>
    <div class="flex justify-between items-center text-xs">
        <span class="text-gray-400 flex items-center gap-2"><Icon name="ri:file-text-line" class="text-primary-500"/> 总字数</span>
        <span class="text-white font-mono">{Math.round(wordCount / 1000)}k</span>
    </div>
    <div class="flex justify-between items-center text-xs">
        <span class="text-gray-400 flex items-center gap-2"><Icon name="ri:time-line" class="text-primary-500"/> 运行天数</span>
        <span class="text-white font-mono">{runDays}</span>
    </div>
  </div>
</div>
